# Enterprise-grade multi-organization schema with group-based authorization

type Template @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  name: String!
  description: String
  version: String
  s3Key: String!
  type: String
  contractYear: String
  organizationId: String! @index(name: "byOrganization", queryField: "templatesByOrganization")
  organizationGroups: [String] # Cognito groups that can access this template
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  owner: String
}

type Provider @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read, update] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  employeeId: String
  name: String!
  providerType: String
  specialty: String
  subspecialty: String
  positionTitle: String
  yearsExperience: Int
  hourlyWage: Float
  baseSalary: Float
  originalAgreementDate: AWSDate
  organizationName: String!
  organizationId: String! @index(name: "byOrganization", queryField: "providersByOrganization")
  organizationGroups: [String] # Cognito groups that can access this provider
  startDate: AWSDate
  contractTerm: String
  ptoDays: Int
  holidayDays: Int
  cmeDays: Int
  cmeAmount: Float
  signingBonus: Float
  relocationBonus: Float
  qualityBonus: Float
  educationBonus: Float
  compensationType: String
  conversionFactor: Float
  wRVUTarget: Float
  compensationYear: String @index(name: "byCompensationYear", queryField: "providersByCompensationYear")
  credentials: String
  compensationModel: String
  clinicalFTE: Float
  medicalDirectorFTE: Float
  divisionChiefFTE: Float
  researchFTE: Float
  teachingFTE: Float
  totalFTE: Float
  administrativeFte: Float
  administrativeRole: String
  fteBreakdown: [FTEBreakdownComponent]
  templateTag: String
  dynamicFields: AWSJSON
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  owner: String
}

type FTEBreakdownComponent {
  activity: String!
  percentage: Float!
}

# Organization management for multi-tenant architecture
type Organization @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "memberGroups", operations: [read] }
]) {
  id: ID!
  name: String!
  description: String
  memberGroups: [String]! # Cognito groups that are members of this organization
  adminGroups: [String]! # Cognito groups that are admins of this organization
  settings: AWSJSON # Organization-specific settings
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

# Template-level field mappings (independent of providers)
type TemplateMapping @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  templateID: ID! @index(name: "byTemplate", queryField: "templateMappingsByTemplateID")
  organizationId: String! @index(name: "byOrganization", queryField: "templateMappingsByOrganization")
  organizationGroups: [String]
  field: String!
  value: String
  notes: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  owner: String
}

# User preferences for enterprise-grade personalization
type UserPreferences @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  userId: String! @index(name: "byUser", queryField: "userPreferencesByUserId")
  organizationId: String! @index(name: "byOrganization", queryField: "userPreferencesByOrganization")
  screen: String! # 'providers', 'templates', 'generator', etc.
  preferences: AWSJSON! # JSON object containing all preferences
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  owner: String
}

# Generator-specific preferences for column management and views
type GeneratorPreferences @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  userId: String! @index(name: "byGeneratorUser", queryField: "generatorPreferencesByUserId")
  organizationId: String! @index(name: "byOrganization", queryField: "generatorPreferencesByOrganization")
  columnPreferences: AWSJSON! # JSON object containing column visibility, order, pinning, saved views
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  owner: String
}

# Provider-specific field mappings (for custom overrides)
type Mapping @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  templateID: ID! @index(name: "byTemplate", queryField: "mappingsByTemplateID") @index(name: "byTemplateAndProvider", queryField: "mappingsByTemplateAndProvider", sortKeyFields: ["providerID"])
  providerID: ID! @index(name: "byProvider", queryField: "mappingsByProviderID")
  organizationId: String! @index(name: "byOrganization", queryField: "mappingsByOrganization")
  organizationGroups: [String]
  field: String!
  value: String
  owner: String
}

type Clause @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  title: String
  text: String!
  tags: [String]
  condition: String
  organizationId: String! @index(name: "byOrganization", queryField: "clausesByOrganization")
  organizationGroups: [String]
  owner: String
}

type DynamicBlock @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  name: String!
  description: String
  placeholder: String!
  outputType: String!
  format: String!
  conditions: AWSJSON
  alwaysInclude: AWSJSON
  organizationId: String! @index(name: "byOrganization", queryField: "dynamicBlocksByOrganization")
  organizationGroups: [String]
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  owner: String
}

type AuditLog @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  action: String!
  user: String
  organizationId: String! @index(name: "byOrganization", queryField: "auditLogsByOrganization")
  organizationGroups: [String]
  timestamp: AWSDateTime!
  details: String
  owner: String
}

type ContractGenerationLog @model @auth(rules: [
  { allow: groups, groups: ["Admin"], operations: [create, update, delete, read] },
  { allow: groups, groupsField: "organizationGroups", operations: [read] },
  { allow: owner, ownerField: "owner", operations: [create, update, delete, read] }
]) {
  id: ID!
  providerId: ID! @index(name: "byProvider", queryField: "generationLogsByProvider")
  contractYear: String! @index(name: "byContractYear", queryField: "generationLogsByContractYear")
  templateId: ID!
  organizationId: String! @index(name: "byOrganization", queryField: "generationLogsByOrganization")
  organizationGroups: [String]
  generatedAt: AWSDateTime!
  generatedBy: String
  outputType: String
  status: String
  fileUrl: String
  notes: String
  owner: String
}

# Custom queries
type Query {
  listProviderYears: [String]
}

type ProviderConnection {
  items: [Provider]
  nextToken: String
}

# Input types for ContractGenerationLog mutations
input CreateContractGenerationLogInput {
  providerId: ID!
  contractYear: String!
  templateId: ID!
  organizationId: String!
  organizationGroups: [String]
  generatedAt: AWSDateTime!
  generatedBy: String
  outputType: String
  status: String
  fileUrl: String
  notes: String
  owner: String
}

input UpdateContractGenerationLogInput {
  id: ID!
  providerId: ID
  contractYear: String
  templateId: ID
  organizationId: String
  organizationGroups: [String]
  generatedAt: AWSDateTime
  generatedBy: String
  outputType: String
  status: String
  fileUrl: String
  notes: String
  owner: String
}

input DeleteContractGenerationLogInput {
  id: ID!
}

input DeleteTemplateInput {
  id: ID!
}

input DeleteProviderInput {
  id: ID!
  _version: Int
}

input DeleteMappingInput {
  id: ID!
}

input DeleteTemplateMappingInput {
  id: ID!
}

input CreateGeneratorPreferencesInput {
  userId: String!
  organizationId: String!
  columnPreferences: AWSJSON!
}