# AWS Production Deployment Guide

## ğŸš€ Overview

This guide provides step-by-step instructions for deploying your React contract generation app to AWS production environment with best practices for security, scalability, and monitoring.

## ğŸ“‹ Prerequisites

- AWS CLI configured with appropriate permissions
- Amplify CLI installed and configured
- Domain name (optional but recommended)
- SSL certificate (handled by AWS Certificate Manager)

## ğŸ”§ Step 1: Environment Configuration

### 1.1 Create Production Environment Variables

Create a `.env.production` file:

```bash
# AWS Configuration
VITE_AWS_REGION=us-east-1
VITE_AWS_ACCESS_KEY_ID=your_production_access_key
VITE_AWS_SECRET_ACCESS_KEY=your_production_secret_key

# S3 Configuration
VITE_S3_BUCKET=your-production-bucket-name

# DynamoDB Table Names (auto-generated by Amplify)
VITE_DYNAMODB_TEMPLATE_TABLE=Template-prod-xxxxxxxxx
VITE_DYNAMODB_PROVIDER_TABLE=Provider-prod-xxxxxxxxx
VITE_DYNAMODB_MAPPING_TABLE=Mapping-prod-xxxxxxxxx
VITE_DYNAMODB_CLAUSE_TABLE=Clause-prod-xxxxxxxxx
VITE_DYNAMODB_AUDIT_TABLE=AuditLog-prod-xxxxxxxxx

# Application Configuration
VITE_APP_NAME=Contract Generator Pro
VITE_APP_VERSION=1.0.0
VITE_MAX_FILE_SIZE=10485760
VITE_MAX_BULK_UPLOAD=1000

# Feature Flags
VITE_ENABLE_COMPRESSION=true
VITE_ENABLE_AUDIT_LOGGING=true
VITE_ENABLE_BULK_OPERATIONS=true
VITE_ENABLE_MONITORING=true
```

### 1.2 Configure AWS IAM Roles

Create production IAM roles with minimal required permissions:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::your-production-bucket",
        "arn:aws:s3:::your-production-bucket/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:GetItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:Query",
        "dynamodb:Scan"
      ],
      "Resource": [
        "arn:aws:dynamodb:us-east-1:*:table/Template-prod-*",
        "arn:aws:dynamodb:us-east-1:*:table/Provider-prod-*",
        "arn:aws:dynamodb:us-east-1:*:table/Mapping-prod-*",
        "arn:aws:dynamodb:us-east-1:*:table/Clause-prod-*",
        "arn:aws:dynamodb:us-east-1:*:table/AuditLog-prod-*"
      ]
    }
  ]
}
```

## ğŸ—ï¸ Step 2: Amplify Backend Deployment

### 2.1 Initialize Amplify (if not already done)

```bash
amplify init
# Choose production environment
# Select your preferred editor
# Choose JavaScript/TypeScript
# Choose React
# Choose AWS profile
```

### 2.2 Add Required Services

```bash
# Add Authentication (Cognito)
amplify add auth
# Choose default configuration
# Choose username sign-in
# Choose no, I am done

# Add API (AppSync + DynamoDB)
amplify add api
# Choose GraphQL
# Choose API key
# Choose single object with fields
# Choose no, I am done

# Add Storage (S3)
amplify add storage
# Choose content
# Choose auth and guest users
# Choose read/write for auth users
# Choose no, I am done

# Add Hosting
amplify add hosting
# Choose Amplify Console
# Choose manual deployment
```

### 2.3 Push to AWS

```bash
amplify push
```

## ğŸ”’ Step 3: Security Configuration

### 3.1 S3 Bucket Security

Update your S3 bucket policy for production:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowAuthUsersAccess",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::YOUR_ACCOUNT_ID:role/amplify-role"
      },
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::your-production-bucket/*",
        "arn:aws:s3:::your-production-bucket"
      ],
      "Condition": {
        "StringEquals": {
          "aws:PrincipalTag/Environment": "production"
        }
      }
    }
  ]
}
```

### 3.2 CORS Configuration

Configure CORS for your S3 bucket:

```json
[
  {
    "AllowedHeaders": ["*"],
    "AllowedMethods": ["GET", "PUT", "POST", "DELETE", "HEAD"],
    "AllowedOrigins": ["https://your-domain.com"],
    "ExposedHeaders": ["ETag"],
    "MaxAgeSeconds": 3000
  }
]
```

### 3.3 DynamoDB Security

Enable encryption at rest and in transit:

```bash
# Update DynamoDB tables with encryption
aws dynamodb update-table \
  --table-name Template-prod-xxxxxxxxx \
  --sse-specification Enabled=true,SSEType=KMS
```

## ğŸ“Š Step 4: Monitoring and Logging

### 4.1 CloudWatch Logs

Enable CloudWatch logging for your AppSync API:

```bash
# Create CloudWatch log group
aws logs create-log-group --log-group-name /aws/appsync/contractgenerator-prod

# Update AppSync logging configuration
aws appsync update-graphql-api \
  --api-id your-api-id \
  --log-config '{"fieldLogLevel":"ALL","cloudWatchLogsRoleArn":"arn:aws:iam::YOUR_ACCOUNT_ID:role/AppSyncCloudWatchLogsRole"}'
```

### 4.2 CloudWatch Alarms

Create alarms for critical metrics:

```bash
# S3 bucket size alarm
aws cloudwatch put-metric-alarm \
  --alarm-name "S3BucketSizeAlarm" \
  --alarm-description "S3 bucket size exceeds threshold" \
  --metric-name BucketSizeBytes \
  --namespace AWS/S3 \
  --statistic Average \
  --period 300 \
  --threshold 10737418240 \
  --comparison-operator GreaterThanThreshold \
  --evaluation-periods 2

# DynamoDB throttling alarm
aws cloudwatch put-metric-alarm \
  --alarm-name "DynamoDBThrottlingAlarm" \
  --alarm-description "DynamoDB throttling detected" \
  --metric-name ThrottledRequests \
  --namespace AWS/DynamoDB \
  --statistic Sum \
  --period 300 \
  --threshold 10 \
  --comparison-operator GreaterThanThreshold \
  --evaluation-periods 1
```

## ğŸš€ Step 5: Frontend Deployment

### 5.1 Build for Production

```bash
# Install dependencies
npm ci

# Build the application
npm run build

# Test the build
npm run test
```

### 5.2 Deploy to Amplify Console

```bash
# Push to Amplify
amplify push

# Deploy hosting
amplify publish
```

### 5.3 Configure Custom Domain (Optional)

1. Go to AWS Amplify Console
2. Select your app
3. Go to Domain Management
4. Add custom domain
5. Configure SSL certificate
6. Update DNS records

## ğŸ”„ Step 6: CI/CD Pipeline

### 6.1 GitHub Actions Workflow

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm test
    
    - name: Build application
      run: npm run build
      env:
        VITE_AWS_REGION: ${{ secrets.AWS_REGION }}
        VITE_AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        VITE_AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        VITE_S3_BUCKET: ${{ secrets.S3_BUCKET }}
    
    - name: Deploy to Amplify
      run: |
        npm install -g @aws-amplify/cli
        amplify configure --yes
        amplify push --yes
```

### 6.2 Environment Secrets

Add these secrets to your GitHub repository:

- `AWS_REGION`
- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `S3_BUCKET`
- `AMPLIFY_APP_ID`

## ğŸ“ˆ Step 7: Performance Optimization

### 7.1 S3 Optimization

```bash
# Enable S3 Transfer Acceleration
aws s3api put-bucket-accelerate-configuration \
  --bucket your-production-bucket \
  --accelerate-configuration Status=Enabled

# Configure lifecycle policies
aws s3api put-bucket-lifecycle-configuration \
  --bucket your-production-bucket \
  --lifecycle-configuration file://lifecycle-policy.json
```

### 7.2 DynamoDB Optimization

```bash
# Create Global Secondary Indexes for common queries
aws dynamodb update-table \
  --table-name Provider-prod-xxxxxxxxx \
  --attribute-definitions AttributeName=specialty,AttributeType=S \
  --global-secondary-index-updates '[{"Create":{"IndexName":"bySpecialty","KeySchema":[{"AttributeName":"specialty","KeyType":"HASH"}],"Projection":{"ProjectionType":"ALL"}}}]'
```

## ğŸ” Step 8: Testing and Validation

### 8.1 Health Check Endpoint

Create a health check endpoint in your app:

```typescript
// src/utils/healthCheck.ts
export async function healthCheck() {
  const checks = {
    s3: await checkS3Health(),
    dynamodb: await checkDynamoDBHealth(),
    appsync: await checkAppSyncHealth(),
  };
  
  return {
    status: Object.values(checks).every(Boolean) ? 'healthy' : 'unhealthy',
    checks,
    timestamp: new Date().toISOString(),
  };
}
```

### 8.2 Load Testing

Use tools like Artillery or k6 for load testing:

```javascript
// load-test.js
import http from 'k6/http';
import { check } from 'k6';

export default function() {
  const response = http.get('https://your-app.amplifyapp.com/health');
  
  check(response, {
    'status is 200': (r) => r.status === 200,
    'response time < 500ms': (r) => r.timings.duration < 500,
  });
}
```

## ğŸ›¡ï¸ Step 9: Security Hardening

### 9.1 WAF Configuration

```bash
# Create WAF Web ACL
aws wafv2 create-web-acl \
  --name "ContractGeneratorWAF" \
  --scope REGIONAL \
  --default-action Allow={} \
  --rules file://waf-rules.json
```

### 9.2 Rate Limiting

Configure rate limiting in your AppSync resolvers:

```javascript
// AppSync resolver
export function request(ctx) {
  const userId = ctx.identity.sub;
  const rateLimit = checkRateLimit(userId);
  
  if (!rateLimit.allowed) {
    util.error('Rate limit exceeded', 'RateLimitExceeded');
  }
  
  return {
    operation: 'PutItem',
    key: util.dynamodb.toMapValues({ id: ctx.args.id }),
    attributeValues: util.dynamodb.toMapValues(ctx.args),
  };
}
```

## ğŸ“Š Step 10: Monitoring Dashboard

### 10.1 CloudWatch Dashboard

Create a comprehensive monitoring dashboard:

```bash
aws cloudwatch put-dashboard \
  --dashboard-name "ContractGeneratorDashboard" \
  --dashboard-body file://dashboard-config.json
```

### 10.2 Key Metrics to Monitor

- S3 bucket size and request count
- DynamoDB read/write capacity units
- AppSync API request count and latency
- Error rates and 4xx/5xx responses
- User authentication success/failure rates

## ğŸ”„ Step 11: Backup and Recovery

### 11.1 S3 Backup Strategy

```bash
# Enable S3 versioning
aws s3api put-bucket-versioning \
  --bucket your-production-bucket \
  --versioning-configuration Status=Enabled

# Configure cross-region replication
aws s3api put-bucket-replication \
  --bucket your-production-bucket \
  --replication-configuration file://replication-config.json
```

### 11.2 DynamoDB Backup

```bash
# Enable point-in-time recovery
aws dynamodb update-continuous-backups \
  --table-name Template-prod-xxxxxxxxx \
  --point-in-time-recovery-specification PointInTimeRecoveryEnabled=true
```

## ğŸš¨ Step 12: Incident Response

### 12.1 Create Runbooks

Document common issues and their solutions:

1. **S3 Upload Failures**
   - Check IAM permissions
   - Verify bucket policy
   - Check CORS configuration

2. **DynamoDB Throttling**
   - Check read/write capacity
   - Review query patterns
   - Consider auto-scaling

3. **AppSync API Errors**
   - Check CloudWatch logs
   - Verify resolver logic
   - Check authentication

### 12.2 Alerting Configuration

Set up alerts for critical issues:

```bash
# Create SNS topic for alerts
aws sns create-topic --name "ContractGeneratorAlerts"

# Subscribe to alerts
aws sns subscribe \
  --topic-arn arn:aws:sns:us-east-1:YOUR_ACCOUNT_ID:ContractGeneratorAlerts \
  --protocol email \
  --notification-endpoint your-email@domain.com
```

## ğŸ“‹ Deployment Checklist

- [ ] Environment variables configured
- [ ] IAM roles and policies created
- [ ] S3 bucket configured with proper permissions
- [ ] DynamoDB tables created with encryption
- [ ] AppSync API deployed
- [ ] Cognito User Pool configured
- [ ] CloudWatch logging enabled
- [ ] Monitoring alarms configured
- [ ] SSL certificate installed
- [ ] Custom domain configured (if applicable)
- [ ] CI/CD pipeline tested
- [ ] Load testing completed
- [ ] Security testing performed
- [ ] Backup strategy implemented
- [ ] Incident response plan documented
- [ ] Team trained on monitoring and alerting

## ğŸ¯ Next Steps

1. **Scale Optimization**: Monitor performance and optimize based on usage patterns
2. **Feature Flags**: Implement feature flags for gradual rollouts
3. **A/B Testing**: Set up A/B testing framework
4. **Analytics**: Integrate analytics for user behavior tracking
5. **Multi-Region**: Consider multi-region deployment for global users

## ğŸ“ Support

For issues or questions:
- Check CloudWatch logs first
- Review AWS documentation
- Contact AWS support if needed
- Monitor AWS Service Health Dashboard 